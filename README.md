# Perplexity Tools

A collection of command-line tools for processing and converting Perplexity-generated markdown content, with special focus on proper citation formatting and PDF generation.

## Overview

This repository contains tools designed to handle the specific formatting challenges that arise when working with markdown content generated by Perplexity AI, particularly when converting to PDF with proper academic-style citations.

## Tools

### 1. `perplexity-preprocess-md.py`

A Python script that preprocesses markdown content to make it compatible with Pandoc's PDF conversion pipeline.

**Features:**
- Converts footnotes to proper Pandoc citations (`[^1]` → `[@ref1]`)
- Consolidates duplicate references automatically
- Fixes escaped math expressions (`\$ ... \$` → `$ ... $`)
- Converts HTML center divs to LaTeX centering commands
- Adds proper YAML front matter with bibliography entries
- Supports multiple languages for citations

**Usage:**
```bash
# Basic usage (reads from stdin, outputs to stdout)
cat input.md | python3 perplexity-preprocess-md.py > output.md

# With language specification
cat input.md | python3 perplexity-preprocess-md.py -l de-DE > output.md

# Available language options: en-US, de-DE, or shortcuts: en, de
```

### 2. `perplexity-md-to-md`

A bash function that performs basic markdown preprocessing, specifically fixing escaped math expressions.

**Usage:**
```bash
# Source the function first
source perplexity-md-to-md

# Convert a markdown file
perplexity-md-to-md input.md
# Creates input-fixed.md in the same directory
```

### 3. `perplexity-md-to-pdf`

A bash function that converts markdown files directly to PDF using Pandoc with optimized settings for academic documents.

**Features:**
- Automatic preprocessing using `perplexity-preprocess-md.py`
- Two-column landscape layout optimized for academic papers
- Proper citation processing with `--citeproc`
- Uses XeLaTeX engine for better Unicode support
- DejaVu Serif font for professional appearance
- Configurable language support

**Usage:**
```bash
# Source the function first
source perplexity-md-to-pdf

# Convert to PDF with default settings (English)
perplexity-md-to-pdf document.md

# Convert with German language support
perplexity-md-to-pdf -l de document.md

# Show help
perplexity-md-to-pdf --help
```

## Installation

### Prerequisites

- Python 3.6+
- Pandoc
- XeLaTeX (usually comes with TeXLive or MiKTeX)
- Bash shell (for the shell functions)

### Setup

1. Clone this repository:
```bash
git clone <repository-url>
cd perplexity-tools
```

2. Make the Python script executable:
```bash
chmod +x perplexity-preprocess-md.py
```

3. Add the shell functions to your bash profile:
```bash
# Add to ~/.bashrc or ~/.zshrc
source /path/to/perplexity-tools/perplexity-md-to-md
source /path/to/perplexity-tools/perplexity-md-to-pdf
```

## Workflow Examples

### Basic Markdown to PDF Conversion

```bash
# Simple conversion
perplexity-md-to-pdf my-document.md
```

### Advanced Workflow with Custom Processing

```bash
# Preprocess only
cat input.md | python3 perplexity-preprocess-md.py -l de > processed.md

# Manual Pandoc conversion with custom options
pandoc processed.md -o output.pdf --pdf-engine=xelatex --citeproc
```

### Batch Processing

```bash
# Convert multiple files
for file in *.md; do
    perplexity-md-to-pdf "$file"
done
```

## Citation Format

The tools automatically convert Perplexity's footnote format to Pandoc's citation system:

**Input (Perplexity format):**
```markdown
This is a claim[^1].

[^1]: https://example.com/source
```

**Output (Pandoc format):**
```markdown
This is a claim[@ref1].

---
references:
  - id: ref1
    type: webpage
    URL: https://example.com/source
csl: https://raw.githubusercontent.com/citation-style-language/styles/master/nature.csl
lang: en-US
---
```

## Configuration

### Language Support

The tools support multiple languages for citation formatting:
- `en-US` (default) - English (United States)
- `de-DE` - German (Germany)
- `en` - Short form for English
- `de` - Short form for German

### PDF Output Settings

The `perplexity-md-to-pdf` function uses these default settings:
- **Layout**: Two-column landscape
- **Paper**: A4
- **Margins**: 1.5cm
- **Column separation**: 1cm
- **Font**: DejaVu Serif
- **Engine**: XeLaTeX

## Troubleshooting

### Common Issues

1. **XeLaTeX not found**: Install TeXLive or MiKTeX
2. **Pandoc not found**: Install Pandoc from [pandoc.org](https://pandoc.org/installing.html)
3. **Font issues**: Ensure DejaVu Serif is installed on your system
4. **Permission denied**: Make sure the Python script is executable

### Debug Mode

For troubleshooting, you can run the preprocessing step separately:

```bash
# Check the preprocessing output
cat input.md | python3 perplexity-preprocess-md.py -l en-US

# Then manually run Pandoc
pandoc processed.md -o output.pdf --pdf-engine=xelatex --citeproc
```

## Contributing

Contributions are welcome! Please feel free to submit issues, feature requests, or pull requests.

## License

This project is licensed under the BSD 3-Clause License - see the [LICENSE](LICENSE) file for details.

## Acknowledgments

- Built for processing content generated by [Perplexity AI](https://perplexity.ai/)
- Uses [Pandoc](https://pandoc.org/) for document conversion
- Citation styles from [Citation Style Language](https://citationstyles.org/)
